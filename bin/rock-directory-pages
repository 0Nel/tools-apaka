#! /usr/bin/env ruby

base_dir = File.expand_path('../lib', File.dirname(__FILE__))
$LOAD_PATH.unshift base_dir

PAGES_DIR = File.join(base_dir, 'rock', 'pages', 'package_directory')

require 'autoproj'
require 'autoproj/cmdline'
require 'rock/package_directory'
require 'optparse'

generate_status = []
parser = OptionParser.new do |opt|
    opt.banner = "rock-directory-pages [OPTIONS] output_dir [api_dir]"
    opt.on('--status=DIFFSPEC', String, "generate status pages. DIFFSPEC is FROM_FLAVOR:TO_FLAVOR,FROM_FLAVOR:TO_FLAVOR,...") do |status|
	generate_status = status.split(',').map do |s|
	    s.split(':')
	end
    end
    opt.on('--help') do
        puts opt
	exit
    end
    opt.on('--debug') do
        Rock::Doc::PackageDirectory.logger.level = Logger::DEBUG
    end
end

remaining  = parser.parse(ARGV)
output_dir = remaining.shift
api_dir    = remaining.shift
if !output_dir
    puts parser
    exit 1
end

Autoproj::CmdLine.initialize_and_load([])
require 'orocos'
Orocos.load

package_directory = Rock::Doc::PackageDirectory.new(output_dir)
package_directory.prepare
package_directory.render_autoproj_packages
package_directory.render_autoproj_package_sets
package_directory.render_autoproj_osdeps
package_directory.render_orogen_types
package_directory.render_orogen_tasks

